<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TikTok Follower Goal Widget</title>
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Tailwind CSS –¥–ª—è –∫—Ä–∞—Å–∏–≤–æ–≥–æ –¥–∏–∑–∞–π–Ω–∞ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º —à—Ä–∏—Ñ—Ç—ã Google -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
            /* –ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω –¥–ª—è OBS */
            background-color: transparent; 
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        /* –ï—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç–æ –ø—Ä–æ—Å—Ç–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ –±–µ–∑ OBS, –¥–æ–±–∞–≤–∏–º —Ç–µ–º–Ω—ã–π —Ñ–æ–Ω –¥–ª—è –Ω–∞–≥–ª—è–¥–Ω–æ—Å—Ç–∏ */
        body:not(.obs-mode) {
            background-color: #0f0f13;
            background-image: radial-gradient(circle at 50% 50%, #1a1a24 0%, #0f0f13 100%);
        }

        .glass-panel {
            background: rgba(20, 20, 25, 0.6);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5), inset 0 0 0 1px rgba(255,255,255,0.05);
        }

        /* –§–∏—Ä–º–µ–Ω–Ω—ã–µ —Ü–≤–µ—Ç–∞ TikTok */
        .text-tiktok {
            background: linear-gradient(90deg, #00f2fe 0%, #fe0979 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .bg-tiktok {
            background: linear-gradient(135deg, #00f2fe 0%, #fe0979 100%);
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –ø—É–ª—å—Å–∞—Ü–∏–∏ –¥–ª—è —Ü–µ–ª–∏ */
        @keyframes pulse-glow {
            0%, 100% { text-shadow: 0 0 10px rgba(254, 9, 121, 0.2); transform: scale(1); }
            50% { text-shadow: 0 0 20px rgba(254, 9, 121, 0.6); transform: scale(1.05); }
        }
        .animate-goal {
            animation: pulse-glow 2s infinite;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        .alert-active {
            opacity: 1 !important;
            transform: translateY(0) scale(1) !important;
            pointer-events: auto !important;
        }
        
        .alert-bg {
            background: linear-gradient(135deg, rgba(0, 242, 254, 0.95), rgba(254, 9, 121, 0.95));
            backdrop-filter: blur(10px);
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ü–∏—Ñ—Ä */
        .pop-animation {
            animation: pop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes pop {
            0% { transform: scale(1); }
            50% { transform: scale(1.3); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body class="text-white antialiased">

    <!-- –≠–ö–†–ê–ù –ù–ê–°–¢–†–û–ô–ö–ò (–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è, –µ—Å–ª–∏ —é–∑–µ—Ä–Ω–µ–π–º –Ω–µ —É–∫–∞–∑–∞–Ω –≤ URL) -->
    <div id="setupScreen" class="hidden flex-col items-center justify-center glass-panel p-8 rounded-3xl w-80 text-center relative overflow-hidden">
        <div class="absolute -top-16 -left-16 w-32 h-32 bg-[#00f2fe] rounded-full mix-blend-screen filter blur-[60px] opacity-40"></div>
        <div class="absolute -bottom-16 -right-16 w-32 h-32 bg-[#fe0979] rounded-full mix-blend-screen filter blur-[60px] opacity-40"></div>
        
        <h2 class="text-xl font-bold mb-2 relative z-10">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–∏–¥–∂–µ—Ç–∞</h2>
        <p class="text-xs text-gray-400 mb-6 relative z-10">–í–≤–µ–¥–∏—Ç–µ –≤–∞—à TikTok —é–∑–µ—Ä–Ω–µ–π–º</p>
        
        <div class="relative w-full mb-4 z-10">
            <span class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 font-bold">@</span>
            <input type="text" id="usernameInput" placeholder="username" class="w-full bg-black/50 border border-gray-600 rounded-xl py-3 pl-8 pr-4 text-white placeholder-gray-500 focus:outline-none focus:border-[#00f2fe] transition-colors">
        </div>
        
        <button onclick="startWidget()" class="w-full bg-tiktok text-white font-bold py-3 rounded-xl shadow-lg hover:shadow-[0_0_20px_rgba(254,9,121,0.5)] transition-all transform hover:scale-105 active:scale-95 z-10">
            –°–æ–∑–¥–∞—Ç—å –≤–∏–¥–∂–µ—Ç
        </button>
    </div>

    <!-- –û–°–ù–û–í–ù–û–ô –í–ò–î–ñ–ï–¢ (–î–ª—è OBS) -->
    <div id="widgetContainer" class="hidden relative w-80 h-32 glass-panel rounded-3xl overflow-hidden shadow-2xl transition-all duration-300">
        
        <!-- –î–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ —Å–≤–µ—á–µ–Ω–∏—è -->
        <div class="absolute -top-10 -left-10 w-40 h-40 bg-[#00f2fe] rounded-full mix-blend-screen filter blur-[70px] opacity-30"></div>
        <div class="absolute -bottom-10 -right-10 w-40 h-40 bg-[#fe0979] rounded-full mix-blend-screen filter blur-[70px] opacity-30"></div>

        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –≤–∏–¥–∂–µ—Ç–∞ -->
        <div class="relative z-10 h-full w-full flex flex-col items-center justify-center p-4">
            
            <!-- –Æ–∑–µ—Ä–Ω–µ–π–º –∏ –∏–∫–æ–Ω–∫–∞ -->
            <div class="flex items-center gap-2 mb-2">
                <svg class="w-5 h-5 fill-current text-white drop-shadow-md" viewBox="0 0 448 512" xmlns="http://www.w3.org/2000/svg">
                    <path d="M448,209.91a210.06,210.06,0,0,1-122.77-39.25V349.38A162.55,162.55,0,1,1,185,188.31V278.2a74.62,74.62,0,1,0,52.23,71.18V0l88,0a121.18,121.18,0,0,0,1.86,22.17h0A122.18,122.18,0,0,0,381,102.39a121.43,121.43,0,0,0,67,20.14Z"/>
                </svg>
                <span id="displayUsername" class="text-white/90 font-semibold text-sm tracking-wider uppercase">@username</span>
            </div>

            <!-- –°—á–µ—Ç—á–∏–∫–∏ (–¢–µ–∫—É—â–∏–π / –¶–µ–ª—å) -->
            <div class="flex items-baseline gap-3">
                <span id="currentFollowers" class="text-4xl font-black text-white drop-shadow-[0_0_10px_rgba(255,255,255,0.3)] transition-all duration-200">0</span>
                <span class="text-gray-500 text-2xl font-light">/</span>
                <span id="goalFollowers" class="text-2xl font-bold text-tiktok animate-goal">1</span>
            </div>
            
        </div>

        <!-- OVERLAY: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –Ω–æ–≤–æ–º –ø–æ–¥–ø–∏—Å—á–∏–∫–µ -->
        <div id="newSubscriberAlert" class="absolute inset-0 alert-bg flex flex-col items-center justify-center opacity-0 transform translate-y-8 scale-95 pointer-events-none transition-all duration-400 ease-out z-50 rounded-3xl">
            <div class="text-white font-black text-2xl mb-1 drop-shadow-lg tracking-wide uppercase">–ù–æ–≤—ã–π –ø–æ–¥–ø–∏—Å—á–∏–∫!</div>
            <div class="text-white/90 text-sm font-semibold flex items-center gap-2">
                <span>–¶–µ–ª—å –æ–±–Ω–æ–≤–ª–µ–Ω–∞</span>
                <span class="text-xl">üöÄ</span>
            </div>
            <!-- –î–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ –ª—É—á–∏ –≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–∏ -->
            <div class="absolute inset-0 bg-[radial-gradient(circle,rgba(255,255,255,0.2)_0%,transparent_60%)] pointer-events-none"></div>
        </div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
        let username = "";
        let currentCount = 0;
        let isSimulating = false; // –û—Ç–∫–ª—é—á–∞–µ–º —Å–∏–º—É–ª—è—Ü–∏—é, —Ç–µ–ø–µ—Ä—å –¥–∞–Ω–Ω—ã–µ —Ä–µ–∞–ª—å–Ω—ã–µ

        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const setupScreen = document.getElementById('setupScreen');
        const widgetContainer = document.getElementById('widgetContainer');
        const displayUsername = document.getElementById('displayUsername');
        const currentFollowersEl = document.getElementById('currentFollowers');
        const goalFollowersEl = document.getElementById('goalFollowers');
        const alertOverlay = document.getElementById('newSubscriberAlert');

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º URL –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
        const urlParams = new URLSearchParams(window.location.search);
        const urlUser = urlParams.get('user');

        if (urlUser) {
            // –ï—Å–ª–∏ –∑–∞–ø—É—â–µ–Ω –∏–∑ OBS —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º ?user=–∏–º—è
            document.body.classList.add('obs-mode');
            startWidget(urlUser);
        } else {
            // –ï—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç –≤ –±—Ä–∞—É–∑–µ—Ä–µ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
            setupScreen.classList.remove('hidden');
            setupScreen.classList.add('flex');
        }

        // –§—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ –≤–∏–¥–∂–µ—Ç–∞
        function startWidget(customUser = null) {
            username = customUser || document.getElementById('usernameInput').value.trim();
            if (!username) return;

            // –£–±–∏—Ä–∞–µ–º @ –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–µ–ª —Å –Ω–∏–º
            username = username.replace('@', '');

            // –û–±–Ω–æ–≤–ª—è–µ–º UI
            setupScreen.classList.add('hidden');
            setupScreen.classList.remove('flex');
            widgetContainer.classList.remove('hidden');
            displayUsername.textContent = `@${username}`;

            // –ï—Å–ª–∏ —ç—Ç–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ, –ø–æ–∫–∞–∂–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É —Å URL
            if (!customUser) {
                const obsUrl = `${window.location.href.split('?')[0]}?user=${username}`;
                console.log("–°—Å—ã–ª–∫–∞ –¥–ª—è OBS:", obsUrl);
                // –ö–æ–ø–∏—Ä—É–µ–º –≤ –±—É—Ñ–µ—Ä (–µ—Å–ª–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–æ –±—Ä–∞—É–∑–µ—Ä–æ–º)
                try {
                    navigator.clipboard.writeText(obsUrl);
                    alert("–í–∏–¥–∂–µ—Ç –∑–∞–ø—É—â–µ–Ω!\n\n–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞.\n–í—Å—Ç–∞–≤—å—Ç–µ –µ—ë –≤ OBS –≤ –∏—Å—Ç–æ—á–Ω–∏–∫ '–ë—Ä–∞—É–∑–µ—Ä' —Å —à–∏—Ä–∏–Ω–æ–π 350 –∏ –≤—ã—Å–æ—Ç–æ–π 150.");
                } catch(e) {}
            }

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
            fetchInitialData();

            // –ó–∞–ø—É—Å–∫–∞–µ–º —Ü–∏–∫–ª –ø—Ä–æ–≤–µ—Ä–∫–∏
            // –í–ê–ñ–ù–û: –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑ –≤ 10 —Å–µ–∫—É–Ω–¥, —á—Ç–æ–±—ã TikTok –Ω–µ –∑–∞–±–∞–Ω–∏–ª –≤–∞—à IP –∑–∞ —Å–ø–∞–º
            setInterval(checkFollowers, 10000); 
        }

        // --- –õ–û–ì–ò–ö–ê –î–ê–ù–ù–´–• --- //

        async function fetchInitialData() {
            try {
                // –û–±—Ä–∞—â–∞–µ–º—Å—è –∫ –Ω–∞—à–µ–º—É —Å–µ—Ä–≤–µ—Ä—É (–æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –ø—É—Ç—å —Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –ª–æ–∫–∞–ª—å–Ω–æ, –∏ –Ω–∞ Railway)
                const response = await fetch(`/api/followers/${username}`);
                const data = await response.json();
                
                if (data.followers !== undefined) {
                    currentCount = data.followers;
                    updateNumbers(currentCount);
                }
            } catch (err) {
                console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–µ:", err);
                updateNumbers(0);
            }
        }

        async function checkFollowers() {
            if (isSimulating) return;

            try {
                // –û–±—Ä–∞—â–∞–µ–º—Å—è –∫ –Ω–∞—à–µ–º—É —Å–µ—Ä–≤–µ—Ä—É –∑–∞ —Å–≤–µ–∂–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏
                const response = await fetch(`/api/followers/${username}`);
                const data = await response.json();
                
                if (data.followers !== undefined) {
                    processNewCount(data.followers);
                }
            } catch (err) {
                console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤:", err);
            }
        }

        function processNewCount(newCount) {
            if (newCount > currentCount) {
                // –ï—Å–ª–∏ —Å—á–µ—Ç—á–∏–∫ —É–≤–µ–ª–∏—á–∏–ª—Å—è - –∑–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∞–∑–¥–Ω–∏–∫!
                currentCount = newCount;
                triggerNewSubscriberEvent();
            } else if (newCount < currentCount) {
                // –ï—Å–ª–∏ –∫—Ç–æ-—Ç–æ –æ—Ç–ø–∏—Å–∞–ª—Å—è, –ø—Ä–æ—Å—Ç–æ —Ç–∏—Ö–æ –æ–±–Ω–æ–≤–ª—è–µ–º —Ü–∏—Ñ—Ä—ã
                currentCount = newCount;
                updateNumbers(currentCount);
            }
        }

        function updateNumbers(count) {
            currentFollowersEl.textContent = count.toLocaleString('ru-RU');
            goalFollowersEl.textContent = (count + 1).toLocaleString('ru-RU');
        }

        function triggerNewSubscriberEvent() {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–≤–µ—Ä–ª–µ–π "–ù–æ–≤—ã–π –ø–æ–¥–ø–∏—Å—á–∏–∫!"
            alertOverlay.classList.add('alert-active');
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä—ã–∂–∫–∞ —Ü–∏—Ñ—Ä
            currentFollowersEl.classList.remove('pop-animation');
            void currentFollowersEl.offsetWidth; // trigger reflow
            currentFollowersEl.classList.add('pop-animation');

            // –û–±–Ω–æ–≤–ª—è–µ–º —Ü–∏—Ñ—Ä—ã —Å—Ä–∞–∑—É
            updateNumbers(currentCount);

            // –ü—Ä—è—á–µ–º –æ–≤–µ—Ä–ª–µ–π —á–µ—Ä–µ–∑ 2.5 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(() => {
                alertOverlay.classList.remove('alert-active');
            }, 2500);
        }
    </script>
</body>
</html>
